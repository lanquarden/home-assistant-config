platform: mqtt
schema: template
name: ld-hall-ch3
command_topic: "hall/light/ld-hall/cmnd/Backlog"
command_on_template: >-
  {% if state is defined %}
  Power3 1;
  {%- endif -%} 
  {% if brightness is defined %}
  Channel3 {{ (brightness / 2.55) | int }}
  {% else %}
  Channel3
  {%- endif -%}
command_off_template: "Power3 0"
state_topic: "hall/light/ld-hall/stat/RESULT"
state_template: >-
  {% if value_json.POWER3 is defined %}
    {{ value_json.POWER3 | lower }}
  {% else %}
    {{ states('light.ld_hall_ch3') }}
  {%- endif -%}
brightness_template: >-
  {% if value_json.Channel3 is defined %}
    {{  (value_json.Channel3 * 2.55) | int }}
  {% else %}
    {% set brightness=state_attr('light.ld_hall_ch3', 'brightness') %}
    {{ brightness if brightness != None else 0 }}
  {%- endif -%}
availability_topic: "hall/light/ld-hall/tele/LWT"
payload_available: "Online"
payload_not_available: "Offline"
json_attributes_topic: "hall/light/ld-hall/tele/STATE"
json_attributes_template: '{{ value_json.Wifi | tojson }}'
qos: 1
retain: false